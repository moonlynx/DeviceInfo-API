# DeviceInfo-API

## Описание

Предоставляет интерфейс для получения данных с устройств по SNMP v1 и v2c

## Системные требования

- nodejs

## Схема БД

### Коллекция устройств

Хранит документы с информацией об устройствах

Имя коллекции с документами устройств задается в '/app/config.js' в поле 'cDevices'

#### Формат документа

```
    {
        id: <Идентификатор устройства>,
        name:
        ip:
        oids: {
            <имя объекта>: <номер объекта>, // имя объекта имеет произвольный формат, соответствующий
            <имя объекта>: <номер объекта>  // [требованию к ключам](https://docs.mongodb.com/v3.6/core/document/#document-structure) mongodb
        }
        comunity: <readonly comunity устройства>
    }
```

#### Пример документа

```
    {
        id: <Идентификатор устройства>,
        name: "HP LaseJet 9050n"
        ip: <ip адрес устройства>
        oids: {
            totalPrintPages: "1.3.6.1.2.1.43.10.2.1.4.1.1"
        }
        comunity: "public"
    }
```

## Файл конфигурации

```
    // В следующих полях указывается адрес и порт, на которых сервер будет прослушивать соединения
    httpHost: "127.0.0.1",
    httpPort: 3001,

    // В следующих полях указывается адрес и порт mongodb сервера
    dbServer: "127.0.0.1",
    dbPort: "27017",

    dbName: "dbDeviceInfo", // Имя базы данных
    username: "readonly", // Имя пользователя для подключения к БД
    password: "readonly", // Пароль пользователя для подключения к БД

    cDevices: "Devices", // Имя коллекции устройств

    authDb: "admin" //Имя БД для аутентификации пользователя
```

## Установка

1. скачать [архив](https://github.com/moonlynx/DeviceInfo-API/blob/master/distr/DeviceInfo-API.zip)
2. распаковать
3. в терминале перейти в папку с проектом
4. установить pm2 pm2-logs и pm2-logrotate глобально: 'npm -g install pm2 pm2-logs pm2-logrotate'
5. установить проект: 'npm install'

## Использование

Сервис:

- принимает GET-запрос с параметром **ip**

```
    http://<адрес сервера>:<порт сервера>/query?ip=<ip-адрес устройства>
```

- возвращает массив значений OID устройства с указанным ip-адресом в формате:

```
    {
        name: <имя оюъекта>,
        oid: <номер объекта>,
        value: <значение>
    }
```

- возвращает пустой массив, если устройство с указанным IP адресом отсутствует в базе данных

- запуск проекта: 'npm start'
- перезапуск проекта: 'npm restart'
- остановка проекта: 'npm stop'